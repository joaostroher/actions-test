name: CI
on:  
  push

jobs:
  check_exit_early:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Check if branch is a tag
        id: check-tag
        run: |
          echo ::set-output name=tag::$(git describe --tags --exact-match ${{ github.ref_name }} 2>/dev/null)
    outputs:
      exit: ${{ github.ref_type == 'branch' && !!steps.check-tag.outputs.tag }}
  build_deploy:
    if: needs.check_exit_early.outputs.exit != 'true'
    env:  
      SCRIPTS_ENVIRONMENT: "${{ github.ref_type== 'tag' && 'production' || 'development' }}"
    runs-on: ubuntu-latest    
    needs: check_exit_early
    steps:      
      - uses: actions/checkout@v2      
      - name: Run a one-line script
        run: |
          echo ${{ needs.check_exit_early.outputs.exit }}         
          echo $GITHUB_SHA
          echo $SCRIPTS_ENVIRONMENT
